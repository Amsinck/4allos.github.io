<#
.SYNOPSIS
    Descri巫o do script.

.DESCRIPTION
    Detalhes sobre o funcionamento do script.

.EXAMPLE
    Exemplos de uso do script.
#># Arquivo: setup_integration_error_reporting.ps1 # Caminho: C:\4All_OS\privado\scripts\setup_integration_error_reporting.ps1 # Descri칞칚o: Script PowerShell para integrar o m칩dulo error_reporting ao ecossistema 4All_Comms. # Este script executa os seguintes passos: #   1. Move o diret칩rio error_reporting para dentro de client #   2. Atualiza os imports em reporter.py #   3. Insere a fun칞칚o is_online() em reporter.py #   4. Atualiza events_handler.py para importar e usar report_error #   5. Executa um teste b치sico de cria칞칚o de log e sincroniza칞칚o  # Define os caminhos $baseDir = "C:\4All_OS\modules\4All_Comms" $sourceDir = Join-Path $baseDir "error_reporting" $targetDir = Join-Path $baseDir "client\error_reporting" $reporterPath = Join-Path $targetDir "reporter.py" $eventsPath = Join-Path $baseDir "client\events_handler.py"  # 1) Move o diret칩rio error_reporting para dentro de client if (Test-Path $sourceDir) {     if (!(Test-Path $targetDir)) {         Move-Item -Path $sourceDir -Destination $targetDir -Force         Write-Host "Diret칩rio movido: $sourceDir -> $targetDir"     } else {         Write-Host "Diret칩rio de destino j치 existe: $targetDir"     } } else {     Write-Host "Diret칩rio fonte n칚o encontrado: $sourceDir" }  # 2) Atualiza imports em reporter.py if (Test-Path $reporterPath) {     $content = Get-Content $reporterPath -Raw     $content = $content -replace "from local_storage", "from ..local_storage"     $content = $content -replace "from p2p_node", "from ..p2p_node"     $content = $content -replace "from encryption", "from ..encryption"     Set-Content $reporterPath -Value $content -Encoding UTF8     Write-Host "Imports em reporter.py atualizados." } else {     Write-Host "Arquivo reporter.py n칚o encontrado em $reporterPath" }  # 3) Insere a fun칞칚o is_online() em reporter.py, se n칚o existir $isOnlineFunc = @" def is_online(host='8.8.8.8', port=53, timeout=3):     \"\"\"Verifica conectividade com a internet via socket.\"\"\"     try:         import socket         socket.setdefaulttimeout(timeout)         s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)         s.connect((host, port))         s.close()         return True     except:         return False "@  if (Test-Path $reporterPath) {     $lines = Get-Content $reporterPath     if (-not ($lines -match "def is_online")) {         $index = $lines.FindIndex({ $_ -match "def report_error" })         if ($index -ge 0) {             $newLines = $lines[0..($index - 1)] + $isOnlineFunc + $lines[$index..($lines.Length - 1)]             Set-Content $reporterPath -Value $newLines -Encoding UTF8             Write-Host "Fun칞칚o is_online inserida em reporter.py"         } else {             Write-Host "Fun칞칚o report_error n칚o encontrada em reporter.py"         }     } else {         Write-Host "Fun칞칚o is_online j치 existe em reporter.py"     } }  # 4) Atualiza events_handler.py para importar e usar report_error if (Test-Path $eventsPath) {     $content = Get-Content $eventsPath     if (-not ($content -match "report_error")) {         # Insere import no topo         $importLine = "from .error_reporting.reporter import report_error"         $content = $importLine + "`n" + $content         # Insere chamada de exemplo no final         $exampleCall = @" # Exemplo de relat칩rio de erro report_error('current_user_id', 'Descri칞칚o de teste', 'test_module') "@         $content += "`n" + $exampleCall         Set-Content $eventsPath -Value $content -Encoding UTF8         Write-Host "events_handler.py atualizado com report_error"     } else {         Write-Host "events_handler.py j치 cont칠m report_error"     } } else {     Write-Host "Arquivo events_handler.py n칚o encontrado em $eventsPath" }  # 5) Teste b치sico de cria칞칚o de log e sincroniza칞칚o Write-Host "`nExecutando teste b치sico..." Write-Host "Simulando relat칩rio de erro de teste..." $pythonScript = @" from client.error_reporting.reporter import report_error report_error('test_user', 'Teste de integra칞칚o conclu칤do', 'setup_script', 'Nenhuma sugest칚o') print('Relat칩rio de erro enviado/salvo com sucesso!') "@ $pythonScriptPath = Join-Path $baseDir "client\error_reporting\test_report_error.py" Set-Content -Path $pythonScriptPath -Value $pythonScript -Encoding UTF8 Start-Process -FilePath "python" -ArgumentList "`"$pythonScriptPath`"" -NoNewWindow -Wait Remove-Item $pythonScriptPath Write-Host "Teste finalizado." 
